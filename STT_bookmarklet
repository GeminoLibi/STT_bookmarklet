javascript:(function(){const r=1,t=.2;let Rt=r,o=null,s=[],i=0,l=!1;if(window.speechSynthesis.speaking)return void window.speechSynthesis.cancel();if(!("speechSynthesis"in window))return void alert("Browser lacks Speech API.");const ss=window.speechSynthesis,a=(r,t,e)=>{const a=document.createElement("button");return Object.assign(a,{textContent:r,onclick:e}).style.cssText=`padding:8px 12px;background-color:${t};color:white;border:none;border-radius:4px;cursor:pointer;font-size:14px;flex-grow:1;`,a.onmouseover=()=>a.style.backgroundColor=p(t),a.onmouseout=()=>a.style.backgroundColor=t,a},p=r=>{let t=parseInt(r.slice(1,3),16),e=parseInt(r.slice(3,5),16),a=parseInt(r.slice(5,7),16);return t=Math.min(255,t+20),e=Math.min(255,e+20),a=Math.min(255,a+20),"#"+((1<<24)+(t<<16)+(e<<8)+a).toString(16).slice(1)},clean=()=>{document.querySelectorAll("[data-tts-o-style]").forEach(r=>{r.classList.remove("tts-h","tts-s"),r.style.cssText=r.dataset.ttsOStyle||"",r.removeAttribute("data-tts-o-style"),r.onclick=null})},d=()=>{document.getElementById("tts-panel")?.remove(),clean()},u=()=>{ss.cancel(),l=!1,i=0,b(-1),removeSelected(),updatePlayBtn()},removeSelected=()=>{document.querySelectorAll(".tts-s").forEach(r=>{r.classList.remove("tts-s"),r.style.cssText=r.dataset.ttsOStyle||""})},playPause=()=>{if(ss.paused){ss.resume(),l=!0}else if(ss.speaking){ss.pause(),l=!1}else{if(i>=s.length)i=0;l=!0,f()}setTimeout(updatePlayBtn,50)},f=()=>{if(!l)return;if(i>=s.length)return void(b(-1),u());const r=s[i],t=new SpeechSynthesisUtterance(r);t.rate=Rt,o&&(t.voice=o),b(i),t.onend=()=>{i++,setTimeout(f,[".","?","!"].includes(r.slice(-1))?500:150)},t.onerror=r=>{console.error("Speech error:",r.error),u()},ss.speak(t)},y=()=>{let r=document.querySelector('main,article,[role="main"]')||document.body,t=r.innerText;if(!t||!t.trim())return alert("No content found."),!1;s=t.split(/\n\s*\n/).map(r=>r.trim()).filter(r=>r.length>0);const e=[];return r.querySelectorAll("p,div,li,h1,h2,h3,h4,h5,h6").forEach((r,t)=>{let a=r.innerText.trim();if(a.length>50){let t=s.findIndex(r=>a.startsWith(r.substring(0,50)));t!==-1&&!e[t]&&(e[t]=r)}}),e},b=r=>{document.querySelectorAll(".tts-h").forEach(r=>{r.classList.remove("tts-h"),r.style.cssText=r.dataset.ttsOStyle||""});if(r<0||r>=s.length)return;const t=y()[r];if(t)t.dataset.ttsOStyle||(t.dataset.ttsOStyle=t.style.cssText),t.classList.add("tts-h"),Object.assign(t.style,{backgroundColor:"rgba(255,255,0,.3)",transition:"background-color .5s"}),t.scrollIntoView({behavior:"smooth",block:"center"})},updatePlayBtn=()=>{const r=document.getElementById("tts-play-b");if(r)if(ss.paused){r.textContent="▶%EF%B8%8F Resume",r.style.backgroundColor="#f39c12"}else if(l){r.textContent="⏸%EF%B8%8F Pause",r.style.backgroundColor="#27ae60"}else{r.textContent="▶%EF%B8%8F Play",r.style.backgroundColor="#27ae60"}},g=r=>{u(),Rt=Math.min(3,Math.max(.5,Rt+r)),document.getElementById("tts-rate-d").textContent=Rt.toFixed(1)+"x",i<s.length&&playPause()},x=r=>{r.forEach((t,e)=>{if(t)t.style.cursor="pointer",t.dataset.ttsOStyle=t.style.cssText,t.onclick=a=>{a.preventDefault(),a.stopPropagation(),removeSelected(),t.classList.add("tts-s"),Object.assign(t.style,{backgroundColor:"rgba(52,152,219,.4)",transition:"background-color .3s"}),u(),i=e,playPause()}})},S=()=>{if(document.getElementById("tts-panel"))return;const r=document.createElement("div");r.id="tts-panel",r.style.cssText="position:fixed;bottom:20px;right:20px;z-index:99999;padding:15px;background-color:#2c3e50;color:white;border:1px solid #34495e;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.5);font-family:sans-serif;display:flex;flex-direction:column;gap:10px;max-width:300px;";const e=document.createElement("div");e.style.cssText="display:flex;justify-content:space-between;align-items:center;";const t=document.createElement("span");t.textContent="🔊 Reader Controls",t.style.cssText="font-weight:bold;font-size:18px;",e.appendChild(t);const o=a("✖","#e74c3c",d);o.style.cssText+="padding:4px 8px;font-size:14px;",e.appendChild(o),r.appendChild(e);const i=document.createElement("div");i.style.cssText="display:flex;gap:10px;align-items:center;justify-content:center;";const l=a("▶%EF%B8%8F Play","#27ae60",playPause);l.id="tts-play-b",l.style.cssText+="padding:8px 12px;font-size:14px;",i.appendChild(l);const p=a("⏹%EF%B8%8F Stop","#c0392b",u);p.style.cssText+="padding:8px 12px;font-size:14px;",i.appendChild(p),r.appendChild(i);const m=document.createElement("div");m.style.cssText="display:flex;gap:10px;align-items:center;";const S=document.createElement("span");S.textContent="Speed:",m.appendChild(S);const k=a("◀%EF%B8%8F Slow","#3498db",()=>g(-t)),C=document.createElement("span");C.id="tts-rate-d",C.textContent=Rt.toFixed(1)+"x",C.style.cssText="min-width:40px;text-align:center;";const j=a("Fast ▶%EF%B8%8F","#3498db",()=>g(t));m.append(k,C,j),r.appendChild(m);const w=document.createElement("div");w.style.cssText="display:flex;flex-direction:column;";const B=document.createElement("label");B.textContent="Voice:",B.htmlFor="tts-voice-s",w.appendChild(B);const q=document.createElement("select");q.id="tts-voice-s",q.style.cssText="padding:8px;border-radius:4px;border:1px solid #34495e;background-color:#ecf0f1;color:#2c3e50;";const D=document.createElement("option");D.value="-1",D.textContent="Default/System",q.appendChild(D),w.appendChild(q),r.appendChild(w);const E=document.createElement("p");E.textContent="Click paragraph to start from there.",E.style.cssText="font-size:13px;margin:5px 0 0 0;text-align:center;padding-top:5px;border-top:1px dotted rgba(255,255,255,.3);",r.appendChild(E),document.body.appendChild(r),updatePlayBtn()},k=()=>{clean();const r=y();if(!r)return;const t=()=>{const e=ss.getVoices();if(0===e.length)return void setTimeout(t,100);S();const a=document.getElementById("tts-voice-s");e.forEach((r,t)=>{const e=document.createElement("option");e.value=t,e.textContent=%60${r.name} (${r.lang})%60,a.appendChild(e)}),a.onchange=r=>{const t=parseInt(r.target.value);o=t===-1?null:e[t],ss.speaking&&u()},a.value="-1",x(r)};0===ss.getVoices().length?ss.onvoiceschanged=t:t()};k()})();
